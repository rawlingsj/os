package:
  name: corepack
  version: 0.22.0
  epoch: 0
  description: Zero-runtime-dependency package acting as bridge between Node projects and their package managers
  copyright:
    - license: MIT
environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
pipeline:
  - uses: fetch
    with:
      expected-sha256: b10265b96c3bcb2223208eb80dc5eb6ced65857072d3baafd3d541661b8fc07b
      uri: https://github.com/nodejs/corepack/releases/download/v${{package.version}}/corepack.tgz
      strip-components: 0
  - runs: |
      mkdir -p ${{targets.destdir}}/usr/share/node_modules/corepack
      cp -R package/* ${{targets.destdir}}/usr/share/node_modules/corepack/

      # Remove windows specific files.
      rm ${{targets.destdir}}/usr/share/node_modules/corepack/shims/*.cmd
      rm ${{targets.destdir}}/usr/share/node_modules/corepack/shims/*.ps1
      rm -rf ${{targets.destdir}}/usr/share/node_modules/corepack/shims/nodewin

      mkdir -p ${{targets.destdir}}/usr/bin
      ln -sf /usr/share/node_modules/corepack/dist/corepack.js ${{targets.destdir}}/usr/bin/corepack
  - uses: strip
update:
  enabled: true
  github:
    identifier: nodejs/corepack
    strip-prefix: v
